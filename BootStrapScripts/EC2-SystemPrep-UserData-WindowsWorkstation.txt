<powershell>
#User variables
$SystemPrepWebHost = 'https://systemprep.s3.amazonaws.com'
$SystemPrepMasterScript = 'SystemPrep-WindowsMaster.ps1'
$SystemPrepParams = @{
    Role = "Workstation"
    Network = "Unclass"
    States = "Highstate"
    NoReboot = $false
}

#System variables
$DateTime = $(get-date -format "yyyyMMdd_HHmm_ss")
$ScriptName = $MyInvocation.mycommand.name
$SystemPrepDir = "${env:SystemDrive}\SystemPrep"
$SystemPrepLogFile = "${SystemPrepDir}\SystemPrep-Log_${DateTime}.txt"

function log {
	[CmdLetBinding()]
	Param(
		[Parameter(Mandatory=$true,Position=0,ValueFromPipeLine=$true,ValueFromPipeLineByPropertyName=$true)] [string[]] $LogMessage
	)
	PROCESS {
		#Writes the input $LogMessage to the log file $SystemPrepLogFile.
		Add-Content -Path $SystemPrepLogFile -Value "$(get-date -format `"yyyyMMdd_HHmm_ss`"): ${ScriptName}: ${LogMessage}"
	}
}

if (-Not (Test-Path $SystemPrepDir)) { New-Item -Path $SystemPrepDir -ItemType "directory" -Force 1>$null; log "Created SystemPrep directory -- ${SystemPrepDir}" } else { log "SystemPrep directory already exists -- $SystemPrepDir" }
$ScriptUrl = "${SystemPrepWebHost}/MasterScripts/${SystemPrepMasterScript}"
$ScriptFullPath = "${SystemPrepDir}\${SystemPrepMasterScript}"
log "Downloading the SystemPrep script file -- ${ScriptUrl}"
((new-object net.webclient).DownloadFile("${ScriptUrl}","${ScriptFullPath}") 2>&1) | log
log "Running the SystemPrep script -- ${ScriptFullPath}"
(Invoke-Expression "& ${ScriptFullPath} @SystemPrepParams" 2>&1) | log
log "Exiting SystemPrep BootStrap script"
</powershell>